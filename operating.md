---
layout: page
title: Operate
permalink: /operating/
---
# How to connect to a tractor
To connect to a tractor you will need a computer running the PolyCan program, the CANable board, and some way to connect to the j1939 OBD II connector on the tractor. We used a j1939 OBD II cable that we then spliced two of the data lines that we actually concerned with. If possible we recommend this solution as tring to just jamn some wires into the tractors female j1939 OBD II connector is more risky (chance of connecting to the wrong port), and does not create as good of a connection. 

<div style="float:right;"><img src="/images/can_connector_pinout.png" alt="connector" width="500"/>
An example of the j1939 OBD II connector and the pinout</div>

There is only two pins that we need to actually connect to, the CAN high and CAN low data line. 
In the following figure these two lines correspond to Pin C and Pin D.

Once you have a wire connected to the CAN high and CAN low pin you need to connect that to the CANable board. Thankfully the CANable board has labels next to the screw terminals as to which pin is CAN high and CAN low. You do not need to attach anything to the ground terminal on the CANable board, you can leave this disconnected. With all the wires connected you should be all set up and ready to send and receive commands!

# How to operate the CANable board
Once you have all the needed libraries installed and running the candlelight firmware, connect the CANable board to your computer and run the bash script “bringUp” it is found in the following location: polycan/CANable/bringup. You will need to run this command from a terminal and give the script superuser privileges.  This can be done by typing the following command (this is assuming you are in the CANable directory):

    sudo ./bringUp

If everything is working correctly you should see the red and green lights on the CANable board go from on to off and remain off. If you don't see the lights change on the board or see a warning printed in the terminal, you will need to try and unplug the board and try the command again (the script should display a line reporting if it correctly created and can device, if there is a warning it will be clear). Once you see the lights correctly turn off, and no warning displayed in the terminal you should be good to go!

# How to operate the CANable board with PolyCAN
The CANable board is integrated into our polycan application. In order to start logging files navigate to the polycan menu option to “Capture Log”. Once you selected this option it will prompt you to enter a name for the log file. Once you enter a name it will start logging and display how many command it has heard so far. Once you are done listening to commands, to exit all you need to do is hit enter and you will be back at the PolyCAN menu with all the commands logged saved to the log file you specified.

For sending a log file the process is nearly identical. First select the menu option to “Send While Capturing Data”, this operation will let you send a log file while listening on the CAN bus to see how the other CAN devices respond to the new commands. 

Note: in the log file generated by this all commands sent out will have a negative timestamp signaling that the board did not actually receive the command but sent it, this way one can see when the commands were actually sent out. 

Once you have selected the correct menu option it will prompt you to enter a log name to store all the commands found while listening. After entering a name and hitting enter it will prompt you for the name of the log file you want to transmit. After you enter a valid log file name the program will start logging all CAN traffic. To send the selected log file you will need to hit enter once. After you hit enter you should see the console show you how many commands have been received and sent. When you are done and want to exit just hit enter again and you will be back at the PolyCan menu.

# How to operate the GreenBoard
To connect the board to a CAN network you will need to connect the CAN high and CAN low data lines to the board. The proper way to connect these lines to the board is shown in the following image. After connecting the board to a CAN network, you can get started with sending or receiving commands.

<div style="margin:0auto;"><img src="/images/GreenBoard.png" alt="GreenBoard" width="500"/>
jCOM Board board breakdown with the terminals used to attach to CAN device highlighted</div>

Once the application is running you need to select the correct COM port that the board is connected to. If the application successfully connected to the board then you will see text appearing in big text box of adding a filter to the board. This means that the board is ready and already listening for any CAN traffic. By default the application saves all commands found in a csv log file in the directory: polyCan_jCOM/polyCan_jCOM/bin/Release/logs/  with a unique name depended on the timestamp of when you started recording.

In order to send command from this board, you first need to claim an address. To do this enter a number in the “Addr” field next to the “Claim Address” button. You must give a valid address number to claim (between 0 and 254) and there can’t be CAN device already using that address. In the big logging text box you will see a message as to weather the address claim was successful. If it was successful then you can being to send logs, otherwise try a different address, verify you are connected to a valid CAN bus, or restart the board.

Even though you claimed an address you will still be able to transmit logs with any source address, this address claim is just a software lock the board has to prevent it from sending commands on a non valid CAN network, but does not actually get used for transmitting log files.

To send a command you first need to load a log file you want to send. The button “Load Log” will open a file selector window. Once you choose an appropriate log file, to being transmitting click the “Transmit Log” button. This will send out the commands as fast as the board allows. 

If for any reason during operation of the board you see the 3 status green lights stay on without any flashing and are having troubles communicating with it, this means that the board got locked up. A problem that we have not been able to prevent. The solution to this is the unplug the board, wait about 5 seconds then plug the board back in. This should reset the board back to an operational state.
